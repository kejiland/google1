name: Node Filter Bot

on:
  workflow_dispatch:
  schedule:
    - cron: '0 0 * * *'  # UTC 0:00 = åŒ—äº¬æ—¶é—´ 8:00

# å…³é”®æƒé™é…ç½®
permissions:
  contents: write

jobs:
  filter:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      # ä¸éœ€è¦æŒ‡å®š tokenï¼Œä½¿ç”¨é»˜è®¤çš„ GITHUB_TOKEN
      
    - name: Setup Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'
        
    - name: Install dependencies
      run: pip install requests
      
    - name: Run node filter
      run: |
        echo "å¼€å§‹æ‰§è¡ŒèŠ‚ç‚¹è¿‡æ»¤..."
        echo "æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
        python filter_nodes.py
        
    - name: Commit results
      run: |
        # é…ç½® Git ç”¨æˆ·ï¼ˆä½¿ç”¨ GitHub Actions çš„å®˜æ–¹èº«ä»½ï¼‰
        git config --global user.name "github-actions[bot]"
        git config --global user.email "41898282+github-actions[bot]@users.noreply.github.com"
        
        # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
        if [ ! -f kejiland.txt ]; then
          echo "é”™è¯¯ï¼škejiland.txt æœªç”Ÿæˆ"
          exit 1
        fi
        
        # æ·»åŠ æ–‡ä»¶
        git add kejiland.txt
        
        # æ£€æŸ¥æ˜¯å¦æœ‰å˜åŒ–
        if git diff --cached --quiet; then
          echo "æ²¡æœ‰æ–°å˜åŒ–"
        else
          # æäº¤
          git commit -m "ğŸ” è‡ªåŠ¨æ›´æ–°èŠ‚ç‚¹åˆ—è¡¨ [$(date +'%Y-%m-%d %H:%M')]"
          
          # æ¨é€
          git push
          echo "âœ… æ›´æ–°å®Œæˆ"
        fi
